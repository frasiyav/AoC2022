âŸ¨lf, Split, ToNumsâŸ© â† â€¢Import "bqn-libs/strings.bqn"
While â† {ğ•©{ğ”½âŸğ”¾âˆ˜ğ”½_ğ•£_ğ”¾âˆ˜ğ”½âŸğ”¾ğ•©}ğ•¨@}Â´

i â† ToNumsâš‡1 " -> "âŠ¸SplitÂ¨ â€¢file.Lines "input14.txt"

grid â†0â¥ŠËœÂ¬Â´Â·â€¿minâ†(âŒˆÂ´â‹ˆâŒŠÂ´)500â€¿0<âŠ¸âˆ¾âˆ¾i
{grid 1Â¨âŒ¾((ğ•¨âŠ¸+Â¨â†•ğ•©Â¬ğ•¨)âŠ¸âŠ‘)â†©}Â´âˆ˜âˆ§Ë˜âˆ¾2â†•Â¨i -âš‡1 min
drop â† 500â€¿0-min

P1 â† { ğ•Š grid:
  OOB â† âˆ¨Â´1â‰ Â·>(0â€¿0<âˆ˜âˆ¾Ë˜â‰¢grid)â‹Â¨âŠ¢
  Blocked â† {ğ•©âŠ‘grid}
  câ†0 â‹„ doneâ†0
  While {ğ•Š:Â¬done}â€¿{ğ•Š:
    Step â† {
      moves â† âŸ¨0â€¿1,Â¯1â€¿1,1â€¿1âŸ©+âš‡1 ğ•©
      Ã—â‰ mâ†/Â¬BlockedÂ¨moves?
        OOBâ—¶Stepâ€¿{ğ•Š:doneâ†©1} m âŠ‘âŠ¸âŠ‘ moves
      ;
        grid 1âŒ¾(ğ•©âŠ¸âŠ‘)â†©
    }
    Step drop
    c+â†©1
  }
  c-1
}

P2 â† { ğ•Š grid:
  grid 1âŒ¾(dropâŠ¸âŠ‘)â†©
  grid (â‰Â·Â»âŠ¢â†‘Ëœ2â€¿1+â‰¢)â†©
  grid {ğ•©Â¬âŠ¸âˆ§âˆ¨Â´Ë˜3â†•(Â»âŠ¢â†‘Ëœ2+â‰ )ğ•¨}`âŒ¾(<Ë˜)â†©

  eâ†âŠ‘âˆ˜/Ë˜0â€¿Â¯1âŠâ‰grid
  (+Â´â¥Šgrid)+Â´+âŸœ1âŠ¸Ã—âŠ¸Ã·âŸœ2 (âŠ‘â‰¢grid)-1+e
}

â€¢Show (P1â‹ˆP2) grid

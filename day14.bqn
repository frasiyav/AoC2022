⟨lf, Split, ToNums⟩ ← •Import "bqn-libs/strings.bqn"
While ← {𝕩{𝔽⍟𝔾∘𝔽_𝕣_𝔾∘𝔽⍟𝔾𝕩}𝕨@}´

i ← ToNums⚇1 " -> "⊸Split¨ •file.Lines "input14.txt"

•Show { # Part 1
  grid ← 0⥊˜3+-´max‿min←(⌈´⋈⌊´)i∾⊸∾<500‿0
  {grid 1¨⌾((𝕨⊸+¨↕1+𝕩-𝕨)⊸⊑)↩}´∘∧˘∾2↕¨i-⚇1 min
  drop ← 500‿0-min
  oob ← 0‿0⋈¨1-˜≢grid
  InBounds ← ∧´⍟2≠⟜oob
  NotBlocked ← {¬grid⊑˜𝕩}

  c←0
  done←0
  While {𝕊:¬done}‿{𝕊:
    c+↩1
    Step ← { 𝕊p:
      {
        ×≠m←/NotBlocked¨𝕩?
          InBounds◶{𝕊:done↩1}‿Step m ⊑⊸⊑ 𝕩
      ;
        grid 1⌾(p⊸⊑)↩
      } ⟨0‿1,¯1‿1,1‿1⟩+⚇1 𝕩
    }
    Step drop
    c+↩
  }
  c-1
}

•Show { # Part 2
  w←1⊑⌈´∾i
  s←⟨2×w,0⟩+-´max‿min←(⌈´⋈⌊´)i∾⊸∾<500‿0
  grid ← 0⥊˜2+s
  {grid 1¨⌾((𝕨⊸+¨↕1+𝕩-𝕨)⊸⊑)↩}´∘∧˘∾2↕¨(i∾<2/⟨500‿0⟩)-⚇1 min-w‿0
  +´⥊{𝕩¬⊸∧∨´˘3↕(»⊢↑˜2+≠)𝕨}`⌾(<˘)⍉grid
}

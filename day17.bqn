âŸ¨HashMapâŸ© â† â€¢Import "bqn-libs/hashmap.bqn"
While â† {ğ•©â€¢_while_ğ•¨@}Â´

jets â† 1âŒŠ'<'-ËœÂ¯1â†“â€¢file.Chars"input17.txt"

shapes â† âŸ¨
  [1â€¿1â€¿1â€¿1]
  [0â€¿1â€¿0,1â€¿1â€¿1,0â€¿1â€¿0]
  [0â€¿0â€¿1,0â€¿0â€¿1,1â€¿1â€¿1]
 â‰[1â€¿1â€¿1â€¿1]
  [1â€¿1,1â€¿1]
âŸ©

shapes {hâ€¿wâ†â‰¢ğ•© â‹„ Â»Ë˜7â†‘Ë˜âŸ¨3+h,-1+wâŸ©â†‘ğ•©}Â¨â†©

_blocked â† {ğ•¨(âˆ¨=â—‹(+Â´)âˆ¨âŸœâ¥ŠâŸœğ•©)â—‹â¥Šâ—¶0â€¿âŠ¢ ğ”½ğ•©}
TrimTop â† (âŠ‘âˆ˜/âˆ¨Â´Ë˜)âŠ¸â†“

init â† âŸ¨0, 0, 0, 1â€¿7â¥Š1âŸ©

Drop â† { ğ•Š âŸ¨h, piececount, j, gridâŸ©:
  piece â† shapes âŠ‘Ëœ 5|piececount
  g â† grid âˆ¾Ëœ 0Ã—piece
  p â† piece âˆ¾ 0Ã—grid
  moving â† 1
  While {ğ•Š:moving}â€¿{ğ•Š:
    p â†© 0â‰¢â—¶pâ€¿âŠ¢ g (jâŠ‘jets)â—¶Â«â€¿Â»Ë˜_blocked p
    j â†© (â‰ jets)|j+1
    0â‰¢â—¶{ğ•Š:g+â†©pâ‹„movingâ†©0}â€¿{pâ†©ğ•©} g Â»_blocked p
  }
  g TrimTopâ†©
  âŸ¨h+g-â—‹â‰ grid, 1+piececount, j, 40â†‘gâŸ©
}

# Part 1
â€¢Show âŠ‘ DropâŸ2022 init

# Part 2
cache â† HashmapËœâŸ¨âŸ©
cycle â† 0
state â† init
While {ğ•Š:0â‰¡cycle}â€¿{ğ•Š:
  state Dropâ†©
  {cache.Has ğ•©?
    cycle â†© (cache.Getğ•©)âˆ¾2â†‘state
  ;
    ğ•© cache.Set 2â†‘state
  } 5âŠ¸|âŒ¾âŠ‘ 1â†“state
}

n â† 1_000_000_000_000
cstarthâ€¿cstartâ€¿cendhâ€¿cend â† cycle
clen â† cend - cstart
cheight â† cendh - cstarth
repeatsâ€¿remainder â† clen (âŒŠâˆ˜Ã·Ëœâ‹ˆ|) n-cstart
â€¢Show (cheight Ã— repeats) + âŠ‘ DropâŸ(cstart+remainder) init
